{\rtf1\ansi\ansicpg936\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;}
{\colortbl;\red255\green255\blue255;\red24\green24\blue24;\red255\green255\blue255;}
{\*\expandedcolortbl;;\cssrgb\c12157\c12157\c12157;\cssrgb\c100000\c100000\c100000;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs32 \AppleTypeServices\AppleTypeServicesF65539 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 <!DOCTYPE html>\
<html lang="zh-CN">\
<head>\
    <meta charset="UTF-8">\
    <title>\uc0\u24863 \u24212 \u22612 \u32599  - \u25163 \u21183 \u20132 \u20114 \u29256 </title>\
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>\
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>\
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>\
    <style>\
        body \{ margin: 0; background: #050505; color: gold; font-family: 'Palatino', serif; overflow: hidden; \}\
        #ui-overlay \{ position: absolute; top: 20px; left: 20px; z-index: 100; pointer-events: none; \}\
        #history \{ position: absolute; right: 20px; top: 20px; width: 200px; background: rgba(0,0,0,0.7); padding: 10px; border: 1px solid #444; height: 80vh; overflow-y: auto; \}\
        .btn-panel \{ position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); pointer-events: auto; \}\
        button \{ background: #333; color: gold; border: 1px solid gold; padding: 10px 20px; cursor: pointer; margin: 0 10px; \}\
        #video-container \{ position: absolute; bottom: 10px; right: 10px; width: 160px; height: 120px; border: 1px solid #333; transform: rotateY(180deg); opacity: 0.5; \}\
        canvas \{ display: block; \}\
        .log-item \{ border-bottom: 1px solid #333; padding: 5px 0; font-size: 0.9em; \}\
    </style>\
</head>\
<body>\
\
<div id="ui-overlay">\
    <h1>\uc0\u24863 \u24212 \u22612 \u32599 </h1>\
    <div id="status">\uc0\u27169 \u24335 \u65306 \u21021 \u22987 \u21270 \u20013 ...</div>\
    <div id="card-desc" style="margin-top: 20px; max-width: 300px; font-size: 1.2em; color: #fff;"></div>\
</div>\
\
<div id="history"><h3>\uc0\u21382 \u21490 \u35760 \u24405 </h3><div id="history-list"></div></div>\
\
<video id="video-container" autoplay></video>\
\
<div class="btn-panel">\
    <button onclick="toggleMode()">\uc0\u20999 \u25442  \u25163 \u21183 /\u40736 \u26631 </button>\
</div>\
\
<script id="ash-vs" type="x-shader/x-vertex">\
    varying vec2 vUv;\
    varying float vLife;\
    uniform float uTime;\
    attribute float aLife;\
    attribute vec3 aOffset;\
    void main() \{\
        vUv = uv;\
        vLife = aLife - uTime * 0.2; \
        vec3 pos = position + aOffset;\
        pos.y += (1.0 - vLife) * 2.0; // \uc0\u21521 \u19978 \u39128 \
        pos.x += sin(uTime + pos.y) * 0.1; // \uc0\u28237 \u27969 \
        vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\
        gl_PointSize = (10.0 * vLife) * (300.0 / -mvPosition.z);\
        gl_Position = projectionMatrix * mvPosition;\
    \}\
</script>\
\
<script id="ash-fs" type="x-shader/x-fragment">\
    varying float vLife;\
    void main() \{\
        if (vLife <= 0.0) discard;\
        gl_FragColor = vec4(0.8, 0.7, 0.5, vLife); // \uc0\u28784 \u28908 \u39068 \u33394 \
    \}\
</script>\
\
<script>\
/** * 1. \uc0\u22522 \u30784 \u37197 \u32622 \u19982 \u29260 \u24211 \
 */\
const CARD_DB = [\
    \{ name: "\uc0\u24858 \u32773 ", up: "\u24320 \u22987 \u12289 \u20882 \u38505 \u12289 \u32431 \u30495 ", rev: "\u40065 \u33725 \u12289 \u33609 \u29575 \u12289 \u34394 \u33635 ", img: "https://upload.wikimedia.org/wikipedia/en/9/90/RWS_Tarot_00_Fool.jpg" \},\
    \{ name: "\uc0\u39764 \u26415 \u24072 ", up: "\u21019 \u36896 \u21147 \u12289 \u34892 \u21160 \u12289 \u28508 \u33021 ", rev: "\u24187 \u35937 \u12289 \u20248 \u26580 \u23521 \u26029 \u12289 \u25805 \u32437 ", img: "https://upload.wikimedia.org/wikipedia/en/d/de/RWS_Tarot_01_Magician.jpg" \},\
    // \uc0\u27492 \u22788 \u21487 \u25193 \u23637 \u33267 78\u24352 ...\
];\
\
let deck = [...CARD_DB];\
let scene, camera, renderer, raycaster;\
let currentCard = null, particles = null;\
let isMouseMode = false;\
let interactionState = 'IDLE'; // IDLE, SCANNING, GRABBING, LOCKED\
\
/** * 2. \uc0\u21021 \u22987 \u21270  Three.js \u22330 \u26223 \
 */\
function initScene() \{\
    scene = new THREE.Scene();\
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\
    renderer = new THREE.WebGLRenderer(\{ antialias: true, alpha: true \});\
    renderer.setSize(window.innerWidth, window.innerHeight);\
    document.body.appendChild(renderer.domElement);\
    \
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\
    scene.add(ambientLight);\
    const pointLight = new THREE.PointLight(0xffd700, 1);\
    pointLight.position.set(5, 5, 5);\
    scene.add(pointLight);\
\
    camera.position.z = 5;\
    raycaster = new THREE.Raycaster();\
    \
    spawnNewCard();\
    animate();\
\}\
\
/** * 3. \uc0\u26680 \u24515 \u21151 \u33021 \u65306 \u29983 \u25104 \u26032 \u21345 \u29260 \
 */\
function spawnNewCard() \{\
    if (deck.length === 0) \{\
        document.getElementById('status').innerText = "\uc0\u29260 \u24211 \u24050 \u31354 ";\
        return;\
    \}\
\
    const geometry = new THREE.BoxGeometry(2, 3, 0.05);\
    const backTex = new THREE.TextureLoader().load('https://i.pinimg.com/originals/81/25/3c/81253c5c9603f02e12e1719b67b36f75.jpg'); // \uc0\u31034 \u20363 \u29260 \u32972 \
    \
    // \uc0\u38543 \u26426 \u25277 \u29260 \u36923 \u36753 \
    const index = Math.floor(Math.random() * deck.length);\
    const cardData = deck.splice(index, 1)[0];\
    const isReversed = Math.random() < 0.5;\
    \
    const frontTex = new THREE.TextureLoader().load(cardData.img, undefined, undefined, (err) => \{\
        console.warn("\uc0\u36148 \u22270 \u21152 \u36733 \u22833 \u36133 \u65292 \u20351 \u29992 \u21344 \u20301 \u33394 ");\
    \});\
\
    const materials = [\
        new THREE.MeshStandardMaterial(\{ color: 0x333333 \}), // side\
        new THREE.MeshStandardMaterial(\{ color: 0x333333 \}), // side\
        new THREE.MeshStandardMaterial(\{ color: 0x333333 \}), // side\
        new THREE.MeshStandardMaterial(\{ color: 0x333333 \}), // side\
        new THREE.MeshStandardMaterial(\{ map: frontTex \}),   // front\
        new THREE.MeshStandardMaterial(\{ map: backTex \})    // back\
    ];\
\
    currentCard = new THREE.Mesh(geometry, materials);\
    currentCard.userData = \{ ...cardData, isReversed \};\
    \
    // \uc0\u22914 \u26524 \u36870 \u20301 \u65292 \u32469 Z\u36724 \u36716 180\
    if (isReversed) currentCard.rotation.z = Math.PI;\
    \
    // \uc0\u21021 \u22987 \u20301 \u32622 \
    currentCard.position.set(0, -5, 0); \
    scene.add(currentCard);\
    \
    // \uc0\u20837 \u22330 \u21160 \u30011 \
    new TWEEN_SIM(currentCard.position).to(\{ y: 0 \}, 1000);\
\}\
\
/** * 4. \uc0\u28784 \u28908 \u36923 \u36753 \u23454 \u29616 \
 */\
function createAshes(targetMesh) \{\
    const count = 2000;\
    const geometry = new THREE.BufferGeometry();\
    const positions = new Float32Array(count * 3);\
    const offsets = new Float32Array(count * 3);\
    const lives = new Float32Array(count);\
    \
    for (let i = 0; i < count; i++) \{\
        lives[i] = Math.random();\
        offsets[i*3] = (Math.random()-0.5) * 2;\
        offsets[i*3+1] = (Math.random()-0.5) * 3;\
        offsets[i*3+2] = (Math.random()-0.5) * 0.1;\
    \}\
    \
    geometry.setAttribute('position', targetMesh.geometry.attributes.position);\
    geometry.setAttribute('aOffset', new THREE.BufferAttribute(offsets, 3));\
    geometry.setAttribute('aLife', new THREE.BufferAttribute(lives, 1));\
    \
    const material = new THREE.ShaderMaterial(\{\
        vertexShader: document.getElementById('ash-vs').textContent,\
        fragmentShader: document.getElementById('ash-fs').textContent,\
        uniforms: \{ uTime: \{ value: 0 \} \},\
        transparent: true,\
        blending: THREE.AdditiveBlending\
    \});\
    \
    const ashPoints = new THREE.Points(geometry, material);\
    ashPoints.position.copy(targetMesh.position);\
    ashPoints.rotation.copy(targetMesh.rotation);\
    scene.add(ashPoints);\
    \
    // \uc0\u31227 \u38500 \u21407 \u21345 \u29260 \u24182 \u35760 \u24405 \
    const data = targetMesh.userData;\
    const record = `$\{data.name\} ($\{data.isReversed ? '\uc0\u36870 \u20301 ' : '\u27491 \u20301 '\})`;\
    const log = document.createElement('div');\
    log.className = 'log-item';\
    log.innerText = record;\
    document.getElementById('history-list').prepend(log);\
    \
    scene.remove(targetMesh);\
    \
    // 3\uc0\u31186 \u21518 \u24443 \u24213 \u28165 \u38500 \u31890 \u23376 \u24182 \u29983 \u25104 \u19979 \u19968 \u24352 \
    setTimeout(() => \{\
        scene.remove(ashPoints);\
        spawnNewCard();\
    \}, 3000);\
    \
    return ashPoints;\
\}\
\
/** * 5. \uc0\u25163 \u21183 \u35782 \u21035 \u19982 \u38477 \u32423 \u36923 \u36753 \
 */\
const hands = new Hands(\{\
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/$\{file\}`\
\});\
\
hands.setOptions(\{ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.5 \});\
hands.onResults(onHandResults);\
\
const videoElement = document.getElementById('video-container');\
const cameraUtils = new Camera(videoElement, \{\
    onFrame: async () => \{ await hands.send(\{image: videoElement\}); \},\
    width: 640, height: 480\
\});\
\
cameraUtils.start().catch(() => \{\
    isMouseMode = true;\
    document.getElementById('status').innerText = "\uc0\u27169 \u24335 \u65306 \u40736 \u26631 \u24863 \u24212  (\u25668 \u20687 \u22836 \u22833 \u36133 )";\
\});\
\
function onHandResults(results) \{\
    if (isMouseMode || !results.multiHandLandmarks.length) return;\
    \
    const landmarks = results.multiHandLandmarks[0];\
    const indexTip = landmarks[8];\
    const thumbTip = landmarks[4];\
    const middleTip = landmarks[12];\
    \
    // \uc0\u35745 \u31639 \u25163 \u21183 \
    const distPinch = Math.hypot(indexTip.x - thumbTip.x, indexTip.y - thumbTip.y);\
    const isOpen = landmarks[12].y < landmarks[9].y && landmarks[20].y < landmarks[17].y;\
    const isFist = landmarks[8].y > landmarks[5].y && landmarks[12].y > landmarks[9].y;\
\
    // \uc0\u22352 \u26631 \u26144 \u23556 \
    const x = (0.5 - indexTip.x) * 10; // \uc0\u38236 \u20687 \u22788 \u29702 \
    const y = (0.5 - indexTip.y) * 8;\
    \
    updateInteraction(x, y, \{ isOpen, isPinch: distPinch < 0.05, isFist \});\
\}\
\
function updateInteraction(x, y, gestures) \{\
    if (!currentCard) return;\
\
    if (gestures.isOpen) \{\
        interactionState = 'SCANNING';\
        document.getElementById('status').innerText = "\uc0\u29366 \u24577 \u65306 \u24863 \u24212 \u20013  (\u25163 \u25484 \u24352 \u24320 )";\
        currentCard.position.lerp(new THREE.Vector3(x, y, 0), 0.1);\
    \} else if (gestures.isPinch) \{\
        interactionState = 'GRABBING';\
        document.getElementById('status').innerText = "\uc0\u29366 \u24577 \u65306 \u25235 \u21462 \u20013 ";\
        currentCard.position.lerp(new THREE.Vector3(x, y, 2), 0.2); // \uc0\u25289 \u36817 \
        currentCard.rotation.y += 0.05; // \uc0\u26059 \u36716 \u23637 \u31034 \
    \} else if (gestures.isFist && interactionState === 'GRABBING') \{\
        interactionState = 'LOCKED';\
        document.getElementById('status').innerText = "\uc0\u29366 \u24577 \u65306 \u30830 \u35748 \u32467 \u26524 ";\
        const data = currentCard.userData;\
        document.getElementById('card-desc').innerText = `$\{data.name\} - $\{data.isReversed ? '\uc0\u36870 \u20301 \u65306 ' + data.rev : '\u27491 \u20301 \u65306 ' + data.up\}`;\
        \
        // \uc0\u35302 \u21457 \u28784 \u28908 \u25928 \u26524 \
        particles = createAshes(currentCard);\
        currentCard = null;\
    \}\
\}\
\
// \uc0\u27169 \u25311 \u31616 \u26131 \u21160 \u30011 \
function TWEEN_SIM(obj) \{\
    this.to = (target, duration) => \{\
        const startY = obj.y;\
        let start = null;\
        const step = (timestamp) => \{\
            if (!start) start = timestamp;\
            const progress = (timestamp - start) / duration;\
            obj.y = startY + (target.y - startY) * Math.min(progress, 1);\
            if (progress < 1) requestAnimationFrame(step);\
        \};\
        requestAnimationFrame(step);\
    \};\
\}\
\
function animate() \{\
    requestAnimationFrame(animate);\
    if (particles) \{\
        particles.material.uniforms.uTime.value += 0.016;\
    \}\
    renderer.render(scene, camera);\
\}\
\
function toggleMode() \{\
    isMouseMode = !isMouseMode;\
    document.getElementById('status').innerText = isMouseMode ? "\uc0\u27169 \u24335 \u65306 \u40736 \u26631 \u24863 \u24212 " : "\u27169 \u24335 \u65306 \u25163 \u21183 \u24863 \u24212 ";\
\}\
\
// \uc0\u21551 \u21160 \
window.onload = initScene;\
\
// \uc0\u40736 \u26631 \u20828 \u24213 \
window.addEventListener('mousemove', (e) => \{\
    if (!isMouseMode) return;\
    const x = (e.clientX / window.innerWidth - 0.5) * 10;\
    const y = -(e.clientY / window.innerHeight - 0.5) * 8;\
    updateInteraction(x, y, \{ isOpen: !e.buttons, isPinch: e.buttons === 1, isFist: e.buttons === 2 \});\
\});\
</script>\
</body>\
</html>}